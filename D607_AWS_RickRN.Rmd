---
title: "D607_AWS_RickRN"
author: "RickRN"
date: "9/5/2020"
output: 
  html_document:
  toc: TRUE
---

```{r setup_1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Title: AWS

AWS Connection


```{r setup_2, echo=TRUE}
library(DBI)
library(tidyverse)

library(nycflights13)  # to bring in airlines table

```

## Setup MySQL database connection 

Obtain login credentials for database connection.

```{r setup_DBcon, echo=TRUE}
#prompt for input 

password_file<-"C:\\password-files-for-r\\AWS_login.csv"

passwords<-read.csv(password_file)
# read in login credentials
df_login <- passwords   # read in login credentials

vardb_user <- df_login$login_name
vardb_password <- df_login$login_password
vardb_schema <- df_login$login_schema
vardb_host <- df_login$login_host




#cat("Host: ", vardb_host, " Schema=", vardb_schema, " username=", vardb_user, " password=", vardb_password)


mydb = dbConnect(RMySQL::MySQL(), user=vardb_user,  password=vardb_password, port=3306, dbname=vardb_schema, host=vardb_host)

```


## Create test airlines table in AWS db 

This phase will do the following:
1. Drop test_aws_airlines table
2. Create test_aws_airlines table
3. Use the airlines table from the nycflights13 package as dataset to load test_aws_airlines
4. rename column names in airlines table to match column names in database
5. write the airlines dataframe into test_aws_airlines table
6. list the entries in the test_aws_airlines table
7. add another row of data from another dataframe ("ZZ Top")
8. list the entries in the test_aws_airlines table


```{r create_aws_table, echo=TRUE}

summary(mydb)     # show summary information for database
dbListTables(mydb) # get list of tables presently in database


dbGetQuery(mydb, "DROP TABLE test_aws_airlines")

dbGetQuery(mydb, "CREATE TABLE `test_aws_airlines` (
  `carrier_code` varchar(2) NOT NULL,
  `airline_name` varchar(45) DEFAULT NULL,
  `airline_misc_comments` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`carrier_code`)
)")


glimpse(airlines)
names(airlines) <- c("carrier_code","airline_name") # col names must align to tbl names
glimpse(airlines)

# copy airlines dataframe into database
written_df <- dbWriteTable(mydb, "test_aws_airlines", airlines, append=TRUE, row.names=FALSE)

(loaded_aws_df <- dbGetQuery(mydb, "select * from test_aws_airlines"))

# add "ZZ Top" entry
more_entries_df <- data.frame("ZZ","ZZ Top Airlines")
names(more_entries_df) <- c("carrier_code","airline_name") # col names must align to tbl names
(more_entries_df)

dbWriteTable(mydb, "test_aws_airlines", more_entries_df, append=TRUE, row.names=FALSE)

(loaded_aws_df <- dbGetQuery(mydb, "select * from test_aws_airlines"))
```

## Closing

Close the database connection

```{r step_, echo=TRUE}
(dbDisconnect(mydb))  # disconnect from database

```

## Summary

narrative
